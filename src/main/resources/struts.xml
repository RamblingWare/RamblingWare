<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.5//EN"
    "http://struts.apache.org/dtds/struts-2.5.dtd">
<struts>
	
	<!-- / (ROOT) -->
	<package name="root" namespace="/" extends="struts-default">
	
		<interceptors>
			<interceptor name="archive" class="org.oddox.action.interceptor.ArchiveInterceptor"></interceptor>
			<interceptor name="header" class="org.oddox.action.interceptor.HeaderInterceptor"></interceptor>
			
			<!-- Archive Interceptor -->
			<interceptor-stack name="archiveStack">
				<interceptor-ref name="header"></interceptor-ref>
				<interceptor-ref name="archive"></interceptor-ref>
				<interceptor-ref name="defaultStack"></interceptor-ref>
			</interceptor-stack>
		</interceptors>

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>

		<global-results>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</global-results>
		
		<global-exception-mappings>
			<exception-mapping exception="java.lang.Exception" result="error"/>
		</global-exception-mappings>
		
		<!-- ACTIONS -->
		<action name="" class="org.oddox.action.HomeAction">
			<result name="success" type="freemarker">/WEB-INF/templates/index.ftl</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/404.ftl</result>
		</action>
		
		<!-- Static pages -->
		<action name="about">
			<result type="freemarker">/WEB-INF/templates/about.ftl</result>
		</action>
		<action name="terms">
			<result type="freemarker">/WEB-INF/templates/terms.ftl</result>
		</action>
		<action name="privacy">
			<result type="freemarker">/WEB-INF/templates/privacy.ftl</result>
		</action>
		
		<!-- RSS and Search -->
		<action name="rss" class="org.oddox.action.RssAction">
			<!-- Success already returns XML -->
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		<action name="search" class="org.oddox.action.SearchAction">
			<!-- Success already redirects to external website -->
			<result name="input" type="freemarker">/WEB-INF/templates/search.ftl</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
		<!-- FORWARD ACTIONS -->
		<action name="blog">
			<result type="redirect">/blog/</result>
		</action>
		<action name="tag">
			<result type="redirect">/tag/</result>
		</action>
		<action name="year">
			<result type="redirect">/year/</result>
		</action>
		<action name="category">
			<result type="redirect">/category/</result>
		</action>
		<action name="author">
			<result type="redirect">/author/</result>
		</action>
		<action name="dashboard">
			<result type="redirect">/dashboard/</result>
		</action>
		<action name="api">
			<result type="redirect">/api/</result>
		</action>
		
		<!-- UNKNOWN ACTIONS ARE 404 ERRORS -->
		<action name="*">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
	</package>
	
	<!-- /BLOG/ -->
	<package name="blog" namespace="/blog" extends="root">

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>
				
		<action name="" class="org.oddox.action.BlogAction">
			<result name="success">/WEB-INF/blog/blog.jsp</result>
			<result name="error">/WEB-INF/blog/blog.jsp</result>
		</action>
		
		<action name="page/*" class="org.oddox.action.BlogAction">
			<result name="success">/WEB-INF/blog/blog.jsp</result>
			<result name="error">/WEB-INF/blog/blog.jsp</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
		<action name="post/*" class="org.oddox.action.PostAction">
			<result name="success">/WEB-INF/blog/post.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
		<action name="*" class="org.oddox.action.PostAction">
			<result name="success">/WEB-INF/blog/post.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
	</package>
	
	<!-- /TAG/ -->
	<package name="tag" namespace="/tag" extends="root">

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>
		
		<action name="" class="org.oddox.action.TagsAction">
			<result name="success">/WEB-INF/tag/tags.jsp</result>
			<result name="error">/WEB-INF/tag/tags.jsp</result>
		</action>
		
		<action name="*/page/*" class="org.oddox.action.TagAction">
			<result name="success">/WEB-INF/tag/tag.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
		<action name="*" class="org.oddox.action.TagAction">
			<result name="success">/WEB-INF/tag/tag.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
	</package>
	
	<!-- /YEAR/ -->
	<package name="year" namespace="/year" extends="root">

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>
		
		<action name="" class="org.oddox.action.YearsAction">
			<result name="success">/WEB-INF/year/years.jsp</result>
			<result name="error">/WEB-INF/year/years.jsp</result>
		</action>
		
		<action name="*/page/*" class="org.oddox.action.YearAction">
			<result name="success">/WEB-INF/year/year.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
		<action name="*" class="org.oddox.action.YearAction">
			<result name="success">/WEB-INF/year/year.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
	</package>
	
	<!-- /CATEGORY/ -->
	<package name="category" namespace="/category" extends="root">

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>
		
		<action name="" class="org.oddox.action.CategoriesAction">
			<result name="success">/WEB-INF/category/categories.jsp</result>
			<result name="error">/WEB-INF/category/categories.jsp</result>
		</action>
		
		<action name="*/page/*" class="org.oddox.action.CategoryAction">
			<result name="success">/WEB-INF/category/category.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
		<action name="*" class="org.oddox.action.CategoryAction">
			<result name="success">/WEB-INF/category/category.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
	</package>
	
	<!-- /AUTHOR/ -->
	<package name="author" namespace="/author" extends="root">

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>
		
		<action name="" class="org.oddox.action.AuthorsAction">
			<result name="success">/WEB-INF/author/authors.jsp</result>
			<result name="error">/WEB-INF/author/authors.jsp</result>
		</action>
		
		<action name="*" class="org.oddox.action.AuthorAction">
			<result name="success">/WEB-INF/author/author.jsp</result>
			<result name="error" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
			<result name="none" type="freemarker">/WEB-INF/templates/error/error.ftl</result>
		</action>
		
	</package>
	
	<!-- /API/ -->
	<package name="api" namespace="/api" extends="root,json-default">
	
		<default-interceptor-ref name="defaultStack"></default-interceptor-ref>
		
		<action name="">
			<result>/dashboard/index.html</result>
		</action>
		
		<action name="" class="org.oddox.action.api.RootAction">
			<result name="none" type="json">
				<param name="noCache">true</param>
				<param name="excludeNullProperties">true</param>
				<param name="includeProperties">
					oddox,version,error,message,data.*
				</param>
			</result>
		</action>
		
		<action name="forgot" class="org.oddox.action.api.ForgotAction">
			<result name="none" type="json">
				<param name="noCache">true</param>
				<param name="excludeNullProperties">true</param>
				<param name="includeProperties">
					forgot,error,message,data.*
				</param>
			</result>
		</action>
		
	</package>
	
	<!-- UNKNOWN NAMESPACE ARE 404 ERRORS -->
	<package name="unknown" namespace="/**" extends="root">
		<!-- UNKNOWN ACTIONS ARE 404 ERRORS -->
		<action name="**">
			<interceptor-ref name="archiveStack"></interceptor-ref>
			<result>/WEB-INF/error/404.jsp</result>
		</action>
	</package>
	
</struts>