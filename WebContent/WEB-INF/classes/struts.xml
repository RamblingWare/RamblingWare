<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">

<struts>
	<constant name="struts.convention.result.path" value="/"></constant>
	<!--<constant name="struts.action.extension" value=""/> -->
	<constant name="struts.ognl.allowStaticMethodAccess" value="true"/>
	<constant name="struts.convention.default.parent.package" value="default"/>
	<constant name="struts.enable.SlashesInActionNames" value="true"/>
	<constant name="struts.mapper.alwaysSelectFullNamespace" value="false"/>
	<constant name="struts.xwork.chaining.copyErrors" value="true"/>
	<constant name="struts.xwork.chaining.copyFieldErrors" value="true"/>
	<constant name="struts.xwork.chaining.copyMessages" value="true"/>
	
	<constant name="struts.devMode" value="false" />
	<constant name="struts.freemarker.templatesCache" value="true"/> 
	<constant name="struts.xslt.nocache" value="false"/>
	<constant name="struts.ognl.logMissingProperties" value="false"/>
	<constant name="struts.el.throwExceptionOnFailure" value="false"/>
	<constant name="struts.ognl.enableExpressionCache" value="true"/>
	<constant name="struts.serve.static" value="false"/>
	
	<!-- / (ROOT) -->
	<package name="root" namespace="/" extends="struts-default">
	
		<interceptors>
			<interceptor name="authentication" class="org.amd.interceptor.AuthenticationInterceptor"></interceptor>
			<interceptor name="archive" class="org.amd.interceptor.ArchiveInterceptor"></interceptor>
			<interceptor name="recentview" class="org.amd.interceptor.RecentViewInterceptor"></interceptor>
			
			<!-- Admin User Authentication -->
			<interceptor-stack name="authStack">
				<interceptor-ref name="authentication"></interceptor-ref>
				<interceptor-ref name="defaultStack"></interceptor-ref>
			</interceptor-stack>
			
			<!-- Archive Interceptor -->
			<interceptor-stack name="archiveStack">
				<interceptor-ref name="recentview"></interceptor-ref>
				<interceptor-ref name="archive"></interceptor-ref>
				<interceptor-ref name="defaultStack"></interceptor-ref>
			</interceptor-stack>
		</interceptors>

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>

		<global-results>
			<result name="login">/WEB-INF/manage/login.jsp</result>
			<result name="error">/WEB-INF/error/error.jsp</result>
		</global-results>
		
		<global-exception-mappings>
			<exception-mapping exception="java.lang.Exception" result="error"/>
		</global-exception-mappings>
		
		<!-- ACTIONS -->	
		<action name="" class="org.amd.action.ViewHomeAction">
			<result name="success">/WEB-INF/post.jsp</result>
			<result name="error">/WEB-INF/error/error.jsp</result>
			<result name="none">/WEB-INF/error/404.jsp</result>
		</action>	
		<action name="about">
			<result>/WEB-INF/about.jsp</result>
		</action>
		<action name="contact">
			<result>/WEB-INF/about.jsp</result>
		</action>
		<action name="terms">
			<result>/WEB-INF/other/terms.jsp</result>
		</action>
		<action name="privacy-policy">
			<result>/WEB-INF/other/privacy.jsp</result>
		</action>
		<action name="rss" class="org.amd.action.RssAction">
			<!-- success already returns the RSS XML -->
			<result name="error">/WEB-INF/error/error.jsp</result>
		</action>
		<action name="search" class="org.amd.action.SearchAction">
			<!-- success already redirects to search website -->
			<result name="error">/WEB-INF/error/error.jsp</result>
		</action>	
		
		<!-- FORWARD ACTIONS -->
		<action name="blog">
			<result type="redirect">/blog/</result>
		</action>
		<action name="manage">
			<result type="redirect">/manage/</result>
		</action>
		
		<!-- SPECIAL PAGES -->
		<!-- <action name="save-the-date">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result>/WEB-INF/other/save-the-date.jsp</result>
		</action>
		<action name="save-the-date-register" class="org.amd.action.wedding.RegisterAction">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result name="success">/WEB-INF/other/save-the-date.jsp</result>
			<result name="error">/WEB-INF/other/save-the-date.jsp</result>
		</action>
		<action name="wedding">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result>/WEB-INF/other/wedding.jsp</result>
		</action>
		<action name=".well-known/acme-challenge/mc0ldXUHJO_f1hwB2G4VuD-eUfN9_09BaXGadGqafLo">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result>/WEB-INF/other/tls.jsp</result>
		</action> -->
		
		<!-- UNKNOWN ACTIONS ARE 404 ERRORS -->
		<action name="*">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result>/WEB-INF/error/404.jsp</result>
		</action>
	</package>
	
	<!-- /BLOG/ -->
	<package name="blog" namespace="/blog" extends="root">

		<default-interceptor-ref name="archiveStack"></default-interceptor-ref>
		
		<action name="search" class="org.amd.action.BlogSearchAction">
			<result name="success">/WEB-INF/search.jsp</result>
			<result name="error">/WEB-INF/search.jsp</result>
		</action>
		
		<action name="" class="org.amd.action.ViewBlogAction">
			<result name="success">/WEB-INF/blog.jsp</result>
			<result name="error">/WEB-INF/blog.jsp</result>
		</action>
		
		<action name="post/**" class="org.amd.action.ViewPostAction">
			<result name="success">/WEB-INF/post.jsp</result>
			<result name="error">/WEB-INF/error/error.jsp</result>
			<result name="none">/WEB-INF/error/404.jsp</result>
		</action>
		
		<!-- UNKNOWN ACTIONS ARE 404 ERRORS -->
		<action name="*">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result>/WEB-INF/error/404.jsp</result>
		</action>
		
	</package>
	
	<!-- /MANAGE/ -->
	<package name="manage" namespace="/manage" extends="root">
	
		<default-interceptor-ref name="authStack"></default-interceptor-ref>
		
		<action name="" class="org.amd.action.manage.ManageMenuAction">
			<result name="success">/WEB-INF/manage/menu.jsp</result>
			<result name="error">/WEB-INF/manage/menu.jsp</result>
		</action>
		
		<action name="menu" class="org.amd.action.manage.ManageMenuAction">
			<result name="success">/WEB-INF/manage/menu.jsp</result>
			<result name="error">/WEB-INF/manage/menu.jsp</result>
		</action>
		
		<action name="newpost" class="org.amd.action.manage.NewPostAction">
			<result name="success">/WEB-INF/manage/newpost.jsp</result>
			<result name="edit">/WEB-INF/manage/menu.jsp</result>
			<result name="error">/WEB-INF/manage/newpost.jsp</result>
		</action>
		
		<action name="posts" class="org.amd.action.manage.ViewPostsAction">
			<result name="success">/WEB-INF/manage/viewposts.jsp</result>
			<result name="error">/WEB-INF/manage/viewposts.jsp</result>
		</action>
		
		<action name="login" class="org.amd.action.manage.LoginAction">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result name="success" type="redirectAction">
		        <param name="actionName">menu</param>
		    </result>
			<result name="error">/WEB-INF/manage/login.jsp</result>
		</action>
		
		<action name="newuser" class="org.amd.action.manage.RegisterAction">
			<result name="success">/WEB-INF/manage/menu.jsp</result>
			<result name="error">/WEB-INF/manage/newuser.jsp</result>
		</action>
		
		<action name="logout" class="org.amd.action.manage.LogoutAction">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result name="success">/WEB-INF/message.jsp</result>
		</action>
		
		<action name="editpost/**" class="org.amd.action.manage.EditPostAction">
			<result name="success">/WEB-INF/manage/editpost.jsp</result>
			<result name="edit">/WEB-INF/manage/menu.jsp</result>
		</action>
		
		<!-- UNKNOWN ACTIONS ARE 404 ERRORS -->
		<action name="*">
			<interceptor-ref name="defaultStack"></interceptor-ref>
			<result>/WEB-INF/error/404.jsp</result>
		</action>
		
	</package>
	
</struts>